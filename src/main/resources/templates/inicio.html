<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inicio</title>
    <link rel="stylesheet" type="text/css" href="/resources/css/styles.css" />
    <link rel="stylesheet" type="text/css" href="/resources/css/carousel.css" />
    <link rel="stylesheet" type="text/css" href="/resources/css/footer.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/2.0.5/css/dataTables.bootstrap5.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
</head>

<body>

    <!-- CABECERA -->
    <div th:replace="~{general :: navbar}"></div>

    <!-- Texto de informacion del proyecto -->
    <div class="container mt-5" style="width: 50%;">
        <h1 class="bold text-center mb-4">"Representación de la infancia en la publicidad española"</h1>
        <h4 class="text-secondary text-center mb-4">Te damos la bienvenida a este proyecto, creado por profesores del área de publicidad y de informática y alimentado por estudiantes de comunicación, tiene como objetivo construir una base de datos histórica sobre la representación de la infancia en la publicidad española.</h4>
        <h4 class="text-secondary text-center mb-4">A través de esta base, buscamos contribuir a la construcción de una memoria colectiva que refleje las transformaciones sociales y culturales de nuestro país desde el siglo XX hasta nuestros días.</h4>
        <h4 class="text-secondary text-center mb-4">En esta plataforma podrás explorar y estudiar anuncios por distintas categorías. Además, te invitamos a contribuir y enriquecer esta base de datos, proporcionando una valiosa fuente de investigación y estudio sobre la evolución de la publicidad y su impacto en la sociedad.</h4>
    </div>

    <!-- Carrusel de ultimos anuncios subidos -->
    <div class="bg-white p-5" style="width:100%">
        <h1 class="bold text-center mb-4">Explora las últimas novedades</h1>
        <div class="cardMode" id="cardMode"
            style="border: 2px solid #ccc; padding: 20px; margin: 20px; background-color:rgb(255, 255, 255);">
            <!-- Carrusel de imagenes -->
            <div id="imageSection" class="container" style="width:90%">
                <h1 class="text-secondary mb-3 p-2 text-center"><i class="fa-regular fa-image"></i> Últimas imágenes
                    añadidas</h1>
                <div id="carouselAds1" class="carousel slide" data-ride="carousel">
                    <div class="carousel-inner" id="ads-container1">
                        <div class="carousel-item active" id="carousel-item0">Item 0</div>
                        <div class="carousel-item" id="carousel-item1">Item 1</div>
                        <div class="carousel-item" id="carousel-item2">Item 2</div>
                        <div class="carousel-item" id="carousel-item3">Item 3</div>
                        <div class="carousel-item" id="carousel-item4">Item 3</div>

                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#carouselAds1"
                        data-bs-slide="prev">
                        <span><i class="fa-solid fa-chevron-left fa-8x"></i></span> <span
                            class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#carouselAds1"
                        data-bs-slide="next">
                        <span><i class="fa-solid fa-chevron-right fa-8x"></i></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
            </div>

            <div id="videoBar" class="mt-4 align-self-center" style="width:100%; margin: auto">
                <hr class="hr-custom" />
            </div>

            <!-- Carrusel de videos -->
            <div id="videoSection" class="container" style="width:90%">
                <h1 class="text-secondary mb-3 p-2 text-center"><i class="fa-solid fa-video"></i> Últimos videos
                    añadidos</h1>
                <div id="carouselAds2" class="carousel slide" data-ride="carousel">
                    <div class="carousel-inner" id="ads-container2">
                        <div class="carousel-item active" id="carousel-item0">Item 0</div>
                        <div class="carousel-item" id="carousel-item1">Item 1</div>
                        <div class="carousel-item" id="carousel-item2">Item 2</div>
                        <div class="carousel-item" id="carousel-item3">Item 3</div>
                        <div class="carousel-item" id="carousel-item4">Item 3</div>

                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#carouselAds2"
                        data-bs-slide="prev">
                        <span><i class="fa-solid fa-chevron-left fa-8x"></i></span> <span
                            class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#carouselAds2"
                        data-bs-slide="next">
                        <span><i class="fa-solid fa-chevron-right fa-8x"></i></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
            </div>

            <div id="audioBar" class="mt-4 align-self-center" style="width:100%; margin: auto">
                <hr class="hr-custom" />
            </div>

            <!-- Carrusel de audios -->
            <div id="audioSection" class="container" style="width:90%">
                <h1 class="text-secondary mb-3 p-2 text-center"><i class="fa-solid fa-volume-high"></i> Últimos audios
                    añadidos</h1>
                <div id="carouselAds3" class="carousel slide" data-ride="carousel">
                    <div class="carousel-inner" id="ads-container3">
                        <div class="carousel-item active" id="carousel-item0">Item 0</div>
                        <div class="carousel-item" id="carousel-item1">Item 1</div>
                        <div class="carousel-item" id="carousel-item2">Item 2</div>
                        <div class="carousel-item" id="carousel-item3">Item 3</div>
                        <div class="carousel-item" id="carousel-item4">Item 3</div>

                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#carouselAds3"
                        data-bs-slide="prev">
                        <span><i class="fa-solid fa-chevron-left fa-8x"></i></span> <span
                            class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#carouselAds3"
                        data-bs-slide="next">
                        <span><i class="fa-solid fa-chevron-right fa-8x"></i></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
            </div>
        </div>

    </div>



    <!--FOOTER-->
    <div th:replace="~{general :: footer}"></div>



    <!-- Script para cargar la informacion de cada carrusel -->
    <script th:inline="javascript">
        /*<![CDATA[*/
        let images = /*[[${images}]]*/[];
        let videos = /*[[${videos}]]*/[];
        let audios = /*[[${audios}]]*/[];


        function displayAds(ads, carouselId) {
            const containerSuffix = carouselId.replace('#carouselAds', '');
            const containerId = 'ads-container' + (containerSuffix ? containerSuffix : '');
            const container = document.getElementById(containerId);

            container.innerHTML = ''; 

            let row = null;
            let carouselItem = null;
            let count = 0;

            ads.forEach((ad, index) => {
                // Cada 4 anuncios comienza un nuevo carousel-item
                if (index % 4 === 0) {
                    if (carouselItem) {
                        carouselItem.appendChild(row);
                    }

                    carouselItem = document.createElement('div');
                    carouselItem.className = 'carousel-item';
                    carouselItem.id = containerId + '-item' + count;
                    if (count === 0) carouselItem.classList.add('active');

                    // Crear una nueva fila para cada grupo de 4 anuncios
                    row = document.createElement('div');  
                    row.className = 'row';

                    container.appendChild(carouselItem);
                    count++;
                }

                const col = document.createElement('div');
                col.className = 'col-md-3 mb-3';
                //Creamos cada tarjeta del carrusel
                col.innerHTML = `
        <div class="card m-2 rounded-5 text-secondary" style="overflow: hidden; border: 3px solid grey; border-radius: 16px!important;">
            ${generateMediaContent(ad)}
            <div class="card-body">
                <h5 class="card-title text-center">${ad.year}</h5>
                <p class="card-text text-center">${ad.advertiser}</p>
                <div style="text-align:center">
                    <a href="/detalleAnuncio?adId=${ad.id}" class="btn btn-primary btn-lg card-button fs-4">Ver más</a>
                </div>
            </div>
        </div>`;

                row.appendChild(col);
            });

            // Agregar la ultima fila al ultimo carousel-item
            if (carouselItem && row) {
                carouselItem.appendChild(row);
            }
        }

        $(document).ready(function () {
            function toggleCarouselControls(carouselId) {
                let totalItems = $(carouselId + ' .carousel-item').length;
                let currentIndex = $(carouselId + ' .carousel-item.active').index() + 1; // +1 because index is 0-based
                $(carouselId + ' .carousel-control-prev').toggle(currentIndex > 1);
                $(carouselId + ' .carousel-control-next').toggle(currentIndex < totalItems);
            }

            // Llama esta función para cada carrusel que quieras controlar
            let carouselIds = ['#carouselAds1', '#carouselAds2', '#carouselAds3']; // Agrega los IDs de los carruseles aquí
            carouselIds.forEach(function (carouselId) {
                $(carouselId).on('slid.bs.carousel', function () {
                    toggleCarouselControls(carouselId);
                });

                // Inicializa los controles al cargar la página
                toggleCarouselControls(carouselId);
            });
        });

        //Llamamos a la funcion de mostrar anuncios para cada tipo multimedia
        document.addEventListener('DOMContentLoaded', function () {
            if (images.length === 0) {
                const section = document.getElementById("imageSection");
                const sectionBar = document.getElementById("videoBar");
                section.style.display = 'none';
                sectionBar.style.display = 'none';
            } else {
                displayAds(images, '#carouselAds1');
            }

            if (videos.length === 0) {
                const section = document.getElementById("videoSection");
                const sectionBar = document.getElementById("videoBar");
                section.style.display = 'none';
                sectionBar.style.display = 'none';
            } else {
                displayAds(videos, '#carouselAds2');
            }

            if (audios.length === 0) {
                const section = document.getElementById("audioSection");
                const sectionBar = document.getElementById("audioBar");
                section.style.display = 'none';
                sectionBar.style.display = 'none';
            } else {
                displayAds(audios, '#carouselAds3');
            }
        });

        //Generamos el contenido multimedia de cada tarjeta
        function generateMediaContent(ad, isFiltered) {
            let url = ad.mediaUrl;
            if (isFiltered) {
                url = ad[16];
            }
            if (url != null && (url.endsWith('.jpg') || url.endsWith('.png') || url.endsWith('.jpeg'))) {
                return `<div class="d-flex align-items-center"><img class="card-img-top" src="${url}" alt="Descripción de la imagen"></div>`;
            } else if (url != null && ( url.endsWith('.mp4') || url.endsWith('.webm'))) {
                return `<video class="card-video-top" controls>
                    <source src="${url}" type="video/${url.split('.').pop()}">
                    Tu navegador no soporta la etiqueta de video.
                </video>`;
            } else if (url != null && (url.endsWith('.mp3') || url.endsWith('.ogg'))) {
                return `<audio class="card-audio-top" controls>
                    <source src="${url}" type="audio/${url.split('.').pop()}">
                    Tu navegador no soporta la etiqueta de audio.
                </audio>`;
            }
            return '';
        }

    </script>
</body>

</html>